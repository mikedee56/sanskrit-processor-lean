# Sanskrit Processor Configuration
# Enable IAST diacritics for proper Sanskrit representation

# === Core Processing Configuration ===
processing:
  # Output settings - AGGRESSIVE IAST
  use_iast_diacritics: true  # FORCE IAST transliterations with diacritics
  preserve_capitalization: true  # Maintain proper noun capitalization
  devanagari_to_iast: true  # Convert Devanagari script to IAST transliteration
  force_iast_conversion: true  # FORCE diacritics on all Sanskrit terms

  # External services
  use_consolidated_services: false  # Use legacy services for better verse lookup
  enable_semantic_analysis: true  # Enable MCP semantic processing
  enable_scripture_lookup: true  # Enable API scripture references
  enable_systematic_matching: true  # Enable systematic term matching from scriptures
  enable_compound_processing: true  # Enable compound word processing

  # Context processing
  enable_context_pipeline: true  # Context pipeline with enhanced protection against mistranslations

  # Sanskrit Linguistic Engine (disabled due to case corruption issues)
  enable_linguistic_engine: false  # DISABLED: Testing revealed case corruption issues

  # Mantra Standardization Engine (ADR-003)
  enable_mantra_standardization: true  # Enable phonetic-to-IAST mantra normalization and smart capitalization

  # Artifact Filter (Post-Processing Enhancement)
  enable_artifact_filter: false  # Default disabled - opt-in for ASR artifact cleanup

  # Core processing settings
  case_sensitive_matching: false  # Enable case-insensitive matching
  confidence_threshold: 0.3  # AGGRESSIVE: Force corrections (was 0.6)
  enable_phonetic_matching: true  # Enable Sanskrit phonetic similarity
  enable_asr_correction: true  # Enable ASR pattern reversal
  max_corrections_per_segment: 50  # INCREASED: Allow more corrections (was 20)
  
  # Fuzzy matching
  fuzzy_matching:
    enabled: true
    max_edit_distance: 3  # Increased for better ASR error handling in verse recognition
    min_confidence: 0.3   # AGGRESSIVE: Force fuzzy matches (was 0.6)
    enable_caching: true  # Cache expensive fuzzy calculations
    enable_phonetic_matching: true  # Sanskrit-aware phonetic matching

  # English context processing
  english_context_processing:
    enable_lexicon_corrections: true  # Apply corrections even in English context
    threshold_increase: 0.0          # DISABLED: No threshold increase (was 0.15)
    max_threshold: 0.4              # AGGRESSIVE: Allow corrections in English (was 0.95)
    proper_nouns_only: false         # If true, revert to old behavior

  # Capitalization preservation
  capitalization_categories:
    divine_name: true          # Always preserve divine names (Krishna, Rama, etc.)
    scripture_title: true      # Always preserve scripture titles (Bhagavad Gita, etc.)
    scripture: true           # Support legacy category name
    deity: true              # Support legacy category name
    place_name: true         # Always preserve place names
    concept: false           # Standard rules for concepts
    compound: false          # Standard rules for compounds

  # Special handling rules for capitalization
  all_caps_handling: "intelligent"  # "upper", "title", "intelligent"
  mixed_case_handling: "preserve"   # "preserve", "standardize"

  # ASR pattern matching
  asr_pattern_matching:
    enabled: true
    enable_compound_splitting: true  # Handle compound word ASR errors
    common_substitutions:
      'ph': 'f'
      'th': 't'
      'sh': 'ś'
      'v': 'w'
    sanskrit_specific: true
  
  # ASR Mode Configuration - For automatic speech recognition generated files
  asr_correction_mode: false  # Default disabled - enable with --asr flag
  asr_settings:
    english_protection_threshold: 0.6  # Lower threshold = more aggressive processing
    case_sensitive_matching: false     # ASR needs case flexibility
    sanskrit_whitelist_override: true  # Bypass protection for known terms
    minimum_correction_target: 30      # Higher target for ASR files (30-40%)
    aggressive_compound_matching: true # Handle compound variations
    enable_fuzzy_matching: true        # Enable fuzzy matching for ASR errors
    fuzzy_threshold: 0.7               # Lower = more aggressive fuzzy matching
    enable_phonetic_patterns: true     # Enable ASR phonetic error correction
    context_detection_sensitivity: 0.5 # More sensitive context detection

  # Smart caching configuration
  caching:
    enabled: true  # Enable/disable lexicon caching
    max_corrections: 2000  # Max cached correction entries
    max_proper_nouns: 1000  # Max cached proper noun entries
    max_memory_mb: 30  # Total memory limit for all caches
    file_check_interval: 1.0  # Seconds between file modification checks
    preload_common_terms: true  # Preload frequently used terms
    report_stats: false  # Report cache stats with processing results

# === Lexicon Configuration ===
lexicons:
  corrections_file: "corrections.yaml"
  proper_nouns_file: "proper_nouns.yaml"

# === Service Configuration ===
services:
  consolidated:
    mcp:
      enabled: true
      server_url: "ws://localhost:8080"
      timeout: 30
      max_retries: 3
    api:
      enabled: true
      timeout: 10
      max_retries: 2

# === Mixed Content Processing Configuration ===
mixed_content_processing:
  enable_invocation_recognition: true  # Detect and format Sanskrit invocations/prayers
  enable_embedded_term_extraction: true  # Extract Sanskrit terms from English commentary
  enable_surgical_editing: true  # Apply surgical edits to corrupted Sanskrit
  enable_scripture_title_formatting: true  # Format scripture titles properly

  # Processing confidence thresholds
  confidence_thresholds:
    invocation_processing: 0.3  # AGGRESSIVE: Force invocation processing (was 0.8)
    surgical_editing: 0.3       # AGGRESSIVE: Force surgical edits (was 0.7)
    embedded_terms: 0.3        # AGGRESSIVE: Force embedded corrections (was 0.75)
    verse_replacement: 0.4     # AGGRESSIVE: Allow verse replacement (was 0.95)

  # Processing modes for different content types
  processing_modes:
    invocation: "format"        # format, preserve, correct
    corrupted_sanskrit: "surgical"  # surgical, replace, preserve
    embedded_terms: "correct"   # correct, preserve, enhance
    mixed_content: "selective"  # selective, comprehensive, preserve

  # Surgical editing configuration
  surgical_editing:
    edit_mode: "moderate"       # conservative, moderate, aggressive
    preserve_english_structure: true
    max_changes_per_segment: 5
    enable_verse_reconstruction: true

# === Performance Configuration ===
performance:
  profiling:
    enabled: false  # Default disabled for zero impact
    detail_level: "basic"  # basic, detailed, full
    memory_sampling_interval: 0.1  # seconds
    cache_reports: true  # Cache for historical comparison

  monitoring:
    track_segment_rate: true
    track_memory_usage: true
    track_service_response_times: true

  # Optimization for concurrent GPU usage
  concurrent_processing:
    cpu_throttle: true  # Reduce CPU usage when GPU processes detected
    max_cpu_percent: 70  # Limit to 70% CPU when other processes running
    batch_size_limit: 50  # Process smaller batches to reduce memory pressure
    io_optimization: true  # Optimize database I/O patterns

# === Database Configuration ===
database:
  enabled: true  # Enable database integration
  path: "data/sanskrit_terms.db"  # Path to existing term database
  fallback_to_yaml: true  # Use YAML lexicons when database unavailable
  connection_timeout: 2.0  # Reduced timeout for concurrent processing
  cache_size: 2000  # Increased cache to reduce I/O
  connection_pool_size: 1  # Single connection to reduce overhead
  batch_queries: true  # Batch database queries for efficiency
  pragma_optimizations: true  # Enable SQLite performance pragmas

# === Context Detection Configuration ===
context_detection:
  thresholds:
    english_confidence: 0.95     # STRICTER: Only protect pure English (was 0.85)
    sanskrit_confidence: 0.2     # AGGRESSIVE: Force Sanskrit processing (was 0.6)
    mixed_content: 0.2           # AGGRESSIVE: Force mixed processing (was 0.4)
    confidence_threshold: 0.3    # AGGRESSIVE: Lower barrier (was 0.6)
    whitelist_override: 0.3      # AGGRESSIVE: Easy override (was 0.9)
    diacritical_density_high: 0.3
    diacritical_density_medium: 0.1
    english_markers_required: 5  # STRICTER: Require more markers for English (was 2)

  markers:
    sanskrit_priority_terms:
      - dharma
      - karma
      - yoga
      - jñāna
      - jnana
      - brahman
      - guru
      - mantra
      - yogavāsiṣṭha
      - yogavasistha
      - śivāśiṣṭha
      - shivashistha
      - gītā
      - gita
      - upaniṣad
      - upanishad

    english_function_words:
      - the
      - and
      - is
      - are
      - was
      - were
      - will
      - would
      - could
      - should
      - can
      - may
      - might
      - in
      - "on"
      - at
      - to
      - from
      - with
      - by
      - for
      - of
      - about
      - this
      - that
      - these
      - those
      - but
      - however
      - therefore
      - because
      - since
      - although
      - while

  processing:
    enable_whitelist_override: true
    debug_logging: false
    cache_context_results: true
    performance_profiling: false

# === Artifact Filter Configuration (Post-Processing) ===
artifact_filter:
  # Pattern-specific toggles
  remove_laughter: true                    # Remove "ha ha", [Laughter] patterns
  remove_phantom_phrases: true             # Remove "thank you for watching" artifacts
  remove_sound_annotations: true           # Remove [Music], [Applause], etc.
  normalize_punctuation: true              # Normalize excessive !!!! and ????

  # Duration thresholds (seconds)
  phantom_phrase_max_duration: 2.0         # Max duration for phantom phrase removal
  standalone_thanks_max_duration: 1.5      # Max duration for standalone "thank you"

  # Context validation
  require_context_check: true              # Enable context-aware filtering

# === Plugin Configuration ===
plugins:
  enabled: false  # Master plugin enable/disable (default: disabled)
  enabled_plugins: []  # Enabled plugins list (plugins must exist in plugins/ directory)
  custom_corrections:
    strict_mode: false
